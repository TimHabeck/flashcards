DATA MINING

Kapitel 6: Locality Sensitive Hashing
Dr. Christian Martin
Wintersemester 2025/26

Abteilung Datenbanken / ScaDS.AI
UniversitÃ¤t Leipzig

THEMENÃœBERSICHT
Hochdimensionale Daten

Graphdaten

DatenstrÃ¶me

Clustering

Dimensionsreduktion

Community
Detection

Windowing

Empfehlungssysteme

Assoziationsregeln

PageRank

Filtern

Locality Sensitive
Hashing

Supervised ML

Web Spam

Momente

6-2

INHALTSVERZEICHNIS

âˆ’ Einleitung
âˆ’ One-Hot-Kodierung
âˆ’ Min-Hash Signaturen
âˆ’ Locality Sensitive Hashing

6-3

PINTEREST VISUAL SEARCH

âˆ’ Finde Ã¤hnliche Bilder fÃ¼r einen gegebenen Bildbereich

6-4

FUNKTIONSWEISE
âˆ’ Sammlung aus Milliarden von Bildern
âˆ’ Berechne ReprÃ¤sentation fÃ¼r jedes Bild (z.B. 4000 Dimensionen)
âˆ’ Finde die Ã¤hnlichsten Bilder fÃ¼r ein gegebenes Bild

ReprÃ¤sentation
2

0

1

5

0

1

0

1

0

0

â€¦

Vergleich

0

2

4

5

0

0 10 1

0

1

2

0

0

2

Ã„hnlichkeit

ReprÃ¤sentation
1

4

0

0

1 11 1

â€¦

1

1 40 0

1

6-5

ANWENDUNGEN

âˆ’ Viele Probleme kÃ¶nnen als folgendes Suchproblem
formuliert werden: Finde die nÃ¤chsten Nachbarn in einem
hochdimensionalen Raum
âˆ’ Beispiele:
âˆ’ Dokumente mit Ã¤hnlichen WÃ¶rtern
âˆ’ Klassifikation
âˆ’ Duplikateleminierung, z.B. in der Webseiten-/Nachrichtensuche
âˆ’ Plagiaterkennung

âˆ’ Kunden mit Ã¤hnlichem Kaufverhalten
âˆ’ Empfehlungen: Musik, Filme, ...
âˆ’ Bilder mit Ã¤hnlichen Merkmalen, z.B. Bildkomplettierung

6-6

[Hays and Efros, SIGGRAPH 2007,
http://graphics.cs.cmu.edu/projects/sceneBILDKOMPLETTIERUNG
completion/scene-completion.pdf]

6-7

ALLGEMEINE BESCHREIBUNG DES PROBLEMS
âˆ’ Gegeben einer Menge von ð‘µ hochdimensionalen Datenpunkten
ð’™ðŸ , ð’™ðŸ , â€¦, ð’™ð‘
âˆ’ Distanzfunktion ð’…(ð’™ð‘– , ð’™j )
âˆ’ Ziel: Finde alle Paare (ð’™ð’Š , ð’™ð’‹ ) innerhalb einer Ã„hnlichkeitsgrenze ð’”:
ð’… ð’™ð’Š , ð’™ð’‹ â‰¤ ð’”
âˆ’ Naive LÃ¶sung: Vergleich aller Paare benÃ¶tigt ð‘¶ ð‘µðŸ Berechnungszeit
âˆ’ Bei ð‘µ = ðŸðŸŽðŸ” Punkten bedeutet dies

ð‘µ ð‘µâˆ’ðŸ
ðŸ

â‰ˆ ðŸ“ âˆ™ ðŸðŸŽðŸðŸ Vergleiche

âˆ’ Mit ðŸðŸŽðŸ” Vergleichen pro Sekunde, benÃ¶tigt man dazu etwa 5 Tage
âˆ’ Ãœber 1 Jahr bei ð‘µ = ðŸðŸŽðŸ• Punkten

âˆ’ Mit Locality Sensitive Hashing: ð‘¶ ð‘µ Berechnungszeit mÃ¶glich
6-8

BEISPIEL: Ã„HNLICHE TEXTDOKUMENTE
Finde Ã¤hnliche Paare in einer riesigen Menge von Textdokumenten

Ut enim ad minim veniam, quis nostrud
exercitation ullamco laboris nisi ut aliquip
ex ea commodo consequat.

Lorem ipsum dolor sit amet, consectetur
adipiscing elit, sed do eiusmod tempor
incididunt ut labore et dolore magna aliqua.

Lorem ipsum dolor sit amet, consectetur
Lorem ipsum
dolor
amet, consectetur
adipiscing
elit, sed
do sit
eiusmod
tempor
Lorem
ipsum
dolor
sit
amet,
consectetur
adipiscing
elit,
sed
do
eiusmod
tempor
incididunt ut labore et dolore magna
aliqua.
Lorem
ipsum
dolor
sit
amet,
consectetur
adipiscing
elit,
sed
do
eiusmod
tempor
incididunt ut labore et dolore magna
aliqua.
Lorem
ipsum
dolor
sit
amet,
consectetur
adipiscing
elit,
sed
do
eiusmod
tempor
incididunt
ut
labore
et
dolore
magna
aliqua.
Ut enim adadipiscing
minim
veniam,
quis
nostrud
Lorem
ipsum
dolor
sit
amet,
consectetur
elit,
sed
do
eiusmod
tempor
incididunt
ut
labore
et
dolore
magna
aliqua.
Ut enim ad
minim laboris
veniam,
quis
nostrud
exercitation
ullamco
nisi
ut
aliquip
adipiscing
elit,
sed
do
eiusmod
tempor
incididunt
ut
labore
et
dolore
magna
aliqua.
enim ad
minim laboris
veniam,nisi
quis
nostrud
ullamco
ut
aliquip
ex exercitation
eaUt
commodo
consequat.
incididunt
ut
labore
et
dolore
magna
aliqua.
enim ad
minim laboris
veniam,nisi
quis
ullamco
ut nostrud
aliquip
ex exercitation
eaUt
commodo
consequat.
enim ad
minim laboris
veniam,nisi
quis
ullamco
ut nostrud
aliquip
ex exercitation
eaUt
commodo
consequat.
Ut
enim
ad
minim
veniam,
quis
laboris nisi
ut nostrud
aliquip
ex exercitation
ea commodoullamco
consequat.
laboris nisi ut aliquip
ex exercitation
ea commodoullamco
consequat.
ex ea commodo consequat.

Probleme:
âˆ’ Textdokumente haben unterschiedliche LÃ¤nge
âˆ’ ReprÃ¤sentation als (hochdimensionaler) Datenpunkt
âˆ’ Gleiche Teile der Dokumente werden in unterschiedlichen Reihenfolgen
angezeigt
âˆ’ Dokumente sind so groÃŸ/zahlreich, dass sie nicht in den Hauptspeicher passen
âˆ’ Zu viele Dokumente zum Vergleichen aller Paare
6-9

3 SCHRITTE ZUM FINDEN Ã„HNLICHER DOKUMENTE
âˆ’ One-Hot-Kodierung: Konvertierung der Dokumente in numerische
ReprÃ¤sentationen
âˆ’ Min-Hashing: Konvertierung langer (hochdimensionaler)
ReprÃ¤sentationen in kurze Ã¤hnlichkeitserhaltende Signaturen
âˆ’ Locality-Sensitive Hashing: Bestimmen von Paaren an Signaturen,
die mit hoher Wahrscheinlichkeit sehr Ã¤hnlich sind

Dokumente

LocalitySensitive
Hashing

Kandidatenpaare

6-10

INHALTSVERZEICHNIS

âˆ’ Einleitung
âˆ’ One-Hot-Kodierung
âˆ’ Min-Hash Signaturen
âˆ’ Locality Sensitive Hashing

6-11

SCHRITT 1: ONE-HOT-KODIERUNG
Ut enim ad minim veniam, quis nostrud
exercitation ullamco laboris nisi ut aliquip
ex ea commodo consequat.
Lorem ipsum dolor sit amet, consectetur
adipiscing elit, sed do eiusmod tempor
incididunt ut labore et dolore magna aliqua.

1 0 1 1 0 1 0 1 0 0 1 0 0 1 1 0 1 1

âˆ’ Darstellung eines Textdokuments als 0-1-Array
âˆ’ Jedes Element des Arrays steht fÃ¼r ein Merkmal
âˆ’ 0 bedeutet, dass Merkmal nicht vorhanden ist
âˆ’ 1 bedeutet, dass Merkmal vorhanden ist (Alternative: Anzahl der Merkmale zÃ¤hlen)

âˆ’ Mehrere MÃ¶glichkeiten, Merkmale aus Textdokumenten zu extrahieren
âˆ’ Beispiel: Merkmal = Wort (Bag-Of-Words)
John ist hÃ¤ufig Ã¼bermÃ¼det.
Lieber hÃ¤ufig Ã¼bermÃ¼det
als stÃ¤ndig Ã¼berwacht.
6-12

N-GRAMME UND K-SHINGLES
âˆ’ Menge aller WÃ¶rter (Bag-Of-Words) berÃ¼cksichtigt nicht die
Anordnung der WÃ¶rter (zu SÃ¤tzen)
âˆ’ N-Gramm: Folge von WÃ¶rtern
âˆ’ 2-Gramme: â€žlieber hÃ¤ufigâ€œ, â€žhÃ¤ufig Ã¼bermÃ¼detâ€œ, â€žÃ¼bermÃ¼det alsâ€œ, â€žals
stÃ¤ndigâ€œ, â€žstÃ¤ndig Ã¼berwachtâ€œ
âˆ’ 3-Gramme: â€ž lieber hÃ¤ufig Ã¼bermÃ¼detâ€œ, â€žhÃ¤ufig Ã¼bermÃ¼det alsâ€œ,
â€žÃ¼bermÃ¼det als stÃ¤ndigâ€œ, â€žals stÃ¤ndig Ã¼berwachtâ€œ

âˆ’ K-Shingle: Teil einer Zeichenkette der LÃ¤nge k
âˆ’ 2-Shingles: â€œliâ€, â€œieâ€, â€œebâ€, â€œbeâ€, â€œerâ€, â€œr â€œ, â€œ hâ€, â€œhÃ¤â€, â€œÃ¤uâ€, â€œufâ€, â€œfiâ€, â€œigâ€, â€œg â€œ,
â€œ Ã¼â€, â€œÃ¼bâ€, â€¦
âˆ’ 3-Shingles: â€œlieâ€, â€œiebâ€, â€œebeâ€, â€œberâ€, â€œer â€, â€œr hâ€œ, â€œ hÃ¤â€, â€œhÃ¤uâ€, â€œÃ¤ufâ€, â€œufiâ€,
â€œfigâ€, â€œig â€, â€¦
6-13

DISTANZMAÃŸ
âˆ’ Distanz zwischen zwei Mengen ð‘‹ðŸ und ð‘‹ðŸ :
Jaccarddistanz

d ð‘‹ðŸ , ð‘‹ðŸ

|ð‘‹ðŸ âˆ© ð‘‹2 |
= 1 âˆ’
|ð‘‹ðŸ âˆª ð‘‹2 |

âˆ’ Jaccarddistanz beschreibt den Anteil der Elemente, welche nicht in
beiden Mengen vorkommen

ð‘‹ðŸ

ð‘‹2

ð‘‘ ð‘‹ðŸ , ð‘‹ðŸ = 5/8

6-14

JACCARDDISTANZ
âˆ’ Berechnung der Jaccarddistanz Ã¼ber One-Hot-Kodierung
âˆ’ Seien ð¶1 und ð¶2 die Kodierungen zweier Mengen
âˆ’ Dann kann die Jaccarddistanz berechnet werden, indem man die
Elemente beider Kodierungen an jeder Position vergleicht:
Anzahl der Positionen mit genau einer Eins
Anzahl der Positionen mit mind. einer Eins
ð‘ƒð‘œð‘  ð¶ âˆ©ð‘ƒð‘œð‘ 1 (ð¶2 )
âˆ’ Oder d ð¶ðŸ , ð¶ðŸ = 1 âˆ’ 1 1
mit ð‘ƒð‘œð‘ 1 ð¶
ð‘ƒð‘œð‘ 1 ð¶1 âˆªð‘ƒð‘œð‘ 1 (ð¶2 )

âˆ’ d ð¶ðŸ , ð¶ðŸ =

Menge an

Positionen mit 1 besetzt

C1
ð¶2

1
1

1
1

0
0

0
0

1
1

1
0

ð¶3

0

1

1

1

0

0

1

ð‘‘ ð¶ðŸ , ð¶ðŸ = 4

5

ð‘‘ ð¶ðŸ , ð¶3 = 6

4

ð‘‘ ð¶2 , ð¶3 = 5
6-15

INHALTSVERZEICHNIS

âˆ’ Einleitung
âˆ’ One-Hot-Kodierung
âˆ’ Min-Hash Signaturen
âˆ’ Locality Sensitive Hashing

6-16

SCHRITT 2: MIN-HASHING
1 0 1 1 0 1 0 1 0 0 1 0 0 1 1 0 1 1

2 9 4 1

âˆ’ Min-Hashing: Konvertierung der Kodierungen in kurze
Ã¤hnlichkeitserhaltende Signaturen
âˆ’ Signaturen sind kÃ¼rzere ReprÃ¤sentationen
âˆ’ Vergleich Ã¼ber Signaturen anstatt Ã¼ber Kodierungen

âˆ’ Idee: â€žHashâ€œ die Kodierungen in Buckets, so dass die meisten
Ã¤hnlichen Paare in dem gleichen Bucket landen
âˆ’ Formal: Finde eine Hash-Funktion h(Â·), so dass:
âˆ’ Falls d(C1,C2) klein, dann h(C1) = h(C2) mit hoher Wahrscheinlichkeit.
âˆ’ Falls d(C1,C2) groÃŸ, dann h(C1) = h(C2) mit niedriger
Wahrscheinlichkeit.

âˆ’ Hash-Funktion hÃ¤ngt vom DistanzmaÃŸ ab: Min-Hashing fÃ¼r Jaccard
6-17

MIN-HASHING
âˆ’ Anwenden einer Permutation ï°1 auf die Elemente der Kodierung ð¶
ï°1

1 0 0 1 0 1 0 1 0 0 1 0 0 1

3 12 0 5 8 10 1 2 6 13 11 4 9 7

ï°1 0 = 2, ï°1 1 = 6,

ï°1 2 =7

âˆ’ Min-Hash-Funktion â„Ž1 auf Kodierung ð¶:
âˆ’ â„Ž1 (ð¶) := min ï°1 (ð‘–), d.h. der Index der ersten Position der
ð‘–:ð¶ð‘– =1

permutierten Kodierung mit einer 1
C

1 0 0 1 0 1 0 1 0 0 1 0 0 1

ï°1
3 12 0 5 8 10 1 2 6 13 11 4 9 7

â„Ž1 ð¶ = 2

âˆ’ Signatur einer Kodierung besteht aus den Min-Hash-Werten
â„Ž1 , â„Ž2 , â€¦ , â„Žð‘› mehrerer unabhÃ¤ngiger Permutationen ï°1 , ï°2 , â€¦ , ï°ð‘›
6-18

MIN-HASHING: BEISPIEL
Permutation ï°

Matrix (Shingles x Dokumenten)

ï°1

ï°2

ï°3

D1

D2

D3 D4

2

4

3

1

0

0

0

Signaturen

3

2

4

1

0

0

1

D1 D2 D3 D4

0

1

0

0

1

0

1

hï°1

2

0

4

0

6

3

2

0

1

0

1

hï°2

0

1

0

1

1

6

1

0

1

0

1

hï°3

3

0

5

0

5

0

6

1

0

1

0

4

5

5

1

0

1

0
6-19

MIN-HASH: ZENTRALE EIGENSCHAFT
âˆ’ FÃ¼r zwei Mengen mit One-Hot-Kodierung ð¶ und ð· bezeichne ð‘‘(ð¶, ð·)
deren Jaccarddistanz. FÃ¼r jede Permutation ï° gilt:
ð¶ ð·
ï°
ð‘ƒð‘Ÿ â„Žðœ‹ (ð¶) â‰  â„Žðœ‹ (ð·) = ð‘‘(ð¶, ð·)
2
0 0
BegrÃ¼ndung:

âˆ’ Wir betrachten die kleinste Zahl aus ðœ‹, die nicht auf
eine Zeile (0,0) verweist (hier: 1)
âˆ’ Die Wahrscheinlichkeit ð‘ƒð‘Ÿ â„Žðœ‹ (ð¶) â‰  â„Žðœ‹ (ð·) bezieht
sich auf das Ereignis, dass diese Zahl auf eine Zeile mit
nur einer Eins verweist: (0,1) oder (1,0)
âˆ’ Da die Permutation zufÃ¤llig ist, entspricht dies:
ð‘ƒð‘Ÿ â„Žðœ‹ (ð¶) â‰  â„Žðœ‹ (ð·) =

Anzahl der Positionen mit genauer einer Eins
= ð‘‘(ð¶, ð·)
Anzahl der Positionen mit mind. einer Eins

3

1

1

0

0

0

1

0

1

6

1

1

5

1

0

4

0

1

6-20

Ã„HNLICHKEIT DER SIGNATUREN
âˆ’ FÃ¼r jede Permutation ï° gilt ð‘ƒð‘Ÿ â„Žðœ‹ (ð¶) â‰  â„Žðœ‹ (ð·) = ð‘‘(ð¶, ð·)
âˆ’ Bei mehreren unabhÃ¤ngigen Permutationen ï°1 , ï°2 , â€¦ , ï°ð‘› , kann der
Wert fÃ¼r ð‘‘(ð¶, ð·) Ã¼ber die relative HÃ¤ufigkeit von
â„Žðœ‹ ð‘– ð¶ â‰  â„Žðœ‹ ð‘– ð·
geschÃ¤tzt werden
ð´ð‘›ð‘§ð‘Žâ„Žð‘™ ð‘¢ð‘›ð‘¡ð‘’ð‘Ÿð‘ ð‘â„Žð‘–ð‘’ð‘‘ð‘™ð‘–ð‘â„Žð‘’ð‘Ÿ ð‘†ð‘–ð‘”ð‘›ð‘Žð‘¡ð‘¢ð‘Ÿð‘’ð‘™ð‘’ð‘šð‘’ð‘›ð‘¡ð‘’
âˆ’ ð‘‘áˆš ð¶, ð· =
â‰ˆ ð‘‘(ð¶, ð·)
ð¿Ã¤ð‘›ð‘”ð‘’ ð‘‘ð‘’ð‘Ÿ ð‘†ð‘–ð‘”ð‘›ð‘Žð‘¡ð‘¢ð‘Ÿ

âˆ’ Je lÃ¤nger die Signatur, desto genauer die SchÃ¤tzung
(Gesetz der groÃŸen Zahlen: Erwartungswert der relativen HÃ¤ufigkeit
ist Wahrscheinlichkeit)

6-21

MIN-HASHING: BEISPIEL
Permutation ï°

Matrix (Shingles x Dokumenten)

ï°1

ï°2

ï°3

D1

D2

D3 D4

2

4

3 S1

1

0

0

0

3

2

4 S2

1

0

0

1

0

1

0 S3

0

1

0

1

6

3

2 S4

0

1

0

1

6

1 S5

0

1

5

0

6 S6

1

0

4

5

5 S7

1

0

Signaturen
D1

D2

D3 D4

hï°1

2

0

4

0

hï°2

0

1

0

1

hï°3

3

0

5

0

1

Paar

Jaccard Signatur

0

1

D1-D2

1

1

D1-D3

0.5

2/3

1

0

D1-D4

6/7

1

0

D2-D3

1

1

D2-D4

0.25

0

D3-D4

1

1

1

6-22

MIN-HASHING: SCHNELLE BERECHNUNG
Permutation ï°

Matrix (Shingles x Dokumenten)

Signaturen

ï°1

ï°2

ï°3

D1

D2

D3 D4

2

4

3 S1

1

0

0

0

hï°1

3

2

4 S2

1

0

0

1

hï°2

0

1

0 S3

0

1

0

1

6

3

2 S4

0

1

0

1

1

6

1 S5

0

1

0

1

5

0

6 S6

1

0

1

0

4

5

5 S7

1

0

1

0

D1

D2

D3 D4

hï°3

6-23

MIN-HASHING: SCHNELLE BERECHNUNG
Permutation ï°

Matrix (Shingles x Dokumenten)

Signaturen

ï°1

ï°2

ï°3

D1

D2

D3 D4

2

4

3 S1

1

0

0

0

hï°1

2

3

2

4 S2

1

0

0

1

hï°2

4

0

1

0 S3

0

1

0

1

hï°3

3

6

3

2 S4

0

1

0

1

1

6

1 S5

0

1

0

1

5

0

6 S6

1

0

1

0

4

5

5 S7

1

0

1

0

D1

D2

D3 D4

6-24

MIN-HASHING: SCHNELLE BERECHNUNG
Permutation ï°

Matrix (Shingles x Dokumenten)

Signaturen

ï°1

ï°2

ï°3

D1

D2

D3 D4

2

4

3 S1

1

0

0

0

hï°1

2

3

3

2

4 S2

1

0

0

1

hï°2

2

2

0

1

0 S3

0

1

0

1

hï°3

3

4

6

3

2 S4

0

1

0

1

1

6

1 S5

0

1

0

1

5

0

6 S6

1

0

1

0

4

5

5 S7

1

0

1

0

D1

D2

D3 D4

6-25

MIN-HASHING: SCHNELLE BERECHNUNG
Permutation ï°

Matrix (Shingles x Dokumenten)

ï°1

ï°2

ï°3

D1

D2

D3 D4

2

4

3 S1

1

0

0

0

3

2

4 S2

1

0

0

1

0

1

0 S3

0

1

0

1

6

3

2 S4

0

1

0

1

1

6

1 S5

0

1

0

1

5

0

6 S6

1

0

1

0

4

5

5 S7

1

0

1

0

Signaturen
D1

D2

D3 D4

hï°1

2

0

0

hï°2

2

1

1

hï°3

3

0

0

6-26

MIN-HASHING: SCHNELLE BERECHNUNG
Permutation ï°

Matrix (Shingles x Dokumenten)

ï°1

ï°2

ï°3

D1

D2

D3 D4

2

4

3 S1

1

0

0

0

3

2

4 S2

1

0

0

1

0

1

0 S3

0

1

0

1

6

3

2 S4

0

1

0

1

1

6

1 S5

0

1

0

1

5

0

6 S6

1

0

1

0

4

5

5 S7

1

0

1

0

Signaturen
D1

D2

D3 D4

hï°1

2

0

0

hï°2

2

1

1

hï°3

3

0

0

6-27

MIN-HASHING: SCHNELLE BERECHNUNG
Permutation ï°

Matrix (Shingles x Dokumenten)

ï°1

ï°2

ï°3

D1

D2

D3 D4

2

4

3 S1

1

0

0

0

3

2

4 S2

1

0

0

1

0

1

0 S3

0

1

0

1

6

3

2 S4

0

1

0

1

1

6

1 S5

0

1

0

1

5

0

6 S6

1

0

1

0

4

5

5 S7

1

0

1

0

Signaturen
D1

D2

D3 D4

hï°1

2

0

5

0

hï°2

0

1

0

1

hï°3

3

0

6

0

6-28

MIN-HASHING: SCHNELLE BERECHNUNG
Permutation ï°

Matrix (Shingles x Dokumenten)

ï°1

ï°2

ï°3

D1

D2

D3 D4

2

4

3 S1

1

0

0

0

3

2

4 S2

1

0

0

1

0

1

0 S3

0

1

0

1

6

3

2 S4

0

1

0

1

1

6

1 S5

0

1

0

1

5

0

6 S6

1

0

1

0

4

5

5 S7

1

0

1

0

Signaturen
D1

D2

D3 D4

hï°1

2

0

4

0

hï°2

0

1

0

1

hï°3

3

0

5

0

6-29

MIN-HASH: IMPLEMENTIERUNG

âˆ’ Problem: Berechnung und Speicherung einer
Permutation ist aufwendig und Speicher-intensiv
âˆ’ Simulation einer Permutation Ã¼ber Zufallshashfunktionen
âˆ’ ZufÃ¤llige Abbildung von N Zahlen auf N Zahlen
âˆ’ z.B. â„Ž ð‘¥ = (ð‘Ž âˆ™ ð‘¥ + ð‘ mod ð‘) mod ð‘, wobei a, b Zufallszahlen
und p eine Primzahl mit p > N

âˆ’ Zufallshashfunktionen â„Ž1 , â„Ž2 , â€¦ , â„Žð‘›
âˆ’ Initiale Signaturmatrix: ð‘†ð¼ðº ð‘–, ð‘ = âˆž fÃ¼r alle
Zufallshashfunktionen ð‘–, One-Hot Codierung c
âˆ’ Algorithmus: FÃ¼r jede Zeile ð‘Ÿ der Dokumentenmatrix
âˆ’ Berechne â„Ž1 ð‘Ÿ , â„Ž2 ð‘Ÿ , â€¦ , â„Žð‘› ð‘Ÿ
âˆ’ FÃ¼r jede Spalte ð‘ mit 1: ð‘†ð¼ðº ð‘–, ð‘ â† min ð‘†ð¼ðº ð‘–, ð‘ , â„Žð‘– ð‘Ÿ
ð‘– = 1, â€¦ , ð‘›

fÃ¼r alle
6-30

IMPLEMENTIERUNG: BEISPIEL
Dokumentenmatrix
Zeile r

C1 C2

Sig(i,c)

C1

C2

1

1

0

h1

âˆž

âˆž

2

0

1

h2

âˆž

âˆž

3

1

1

Signaturmatrix

4

1

0

5

0

1

Zufallshashfunktionen
h1(x) = ((x) mod 47) mod 5
h2(x) = ((2x+1) mod 47) mod 5

Sig(i,c)

C1

C2

h1(1)=1 h1

1

âˆž

h2(1)=3 h2

3

âˆž

C1

C2

1

2

3

0

C1

C2

h1(3)=3 h1

1

2

h2(3)=2 h2

2

0

C1

C2

h1(4)=4 h1

1

2

h2(4)=4 h2

2

0

C1

C2

1

0

2

0

Sig(i,c)
h1(2)=2 h1
h2(2)=0 h2
Sig(i,c)

Sig(i,c)

Sig(i,c)
h1(5)=0 h1
h2(5)=1 h2

6-31

INHALTSVERZEICHNIS

âˆ’ Einleitung
âˆ’ One-Hot-Kodierung
âˆ’ Min-Hash Signaturen
âˆ’ Locality Sensitive Hashing

6-32

SCHRITT 3: LOCALITY SENSITIVE HASHING
âˆ’ Locality Sensitive Hashing (LSH): BeschrÃ¤nkung auf Paare von
Signaturen, die hÃ¶chst wahrscheinlich Ã¤hnlich sind
ð‘ªðŸ
ð‘ªðŸ
ð‘ªðŸ‘

2 9 4 1
4 8 1 2
7 3 0 5

ð‘ªð‘µ

â€¦
4 8 1 3

LocalitySensitive
Hashing

ð‘ªðŸ - ð‘ªðŸ“
ð‘ªðŸ - ð‘ªðŸ’ðŸ
ð‘ªðŸ‘ - ð‘ªð‘µ
â€¦

âˆ’ Nur die Paare von Signaturen, die Ã¼ber LSH ausgewÃ¤hlt wurden,
werden auf Ã„hnlichkeit untersucht (SchÃ¤tzung der Jaccarddistanz)
âˆ’ Vorteil: Im Idealfall wird nur ein kleiner Bruchteil von Paaren
untersucht
âˆ’ Nachteil: Es gibt False Negatives
âˆ’ Ã„hnliche Paare, die nicht entdeckt wurden
âˆ’ Die Rate der False Negatives gilt es, so klein wie mÃ¶glich zu halten
6-33

LSH
âˆ’ Ziel: Dokumentenpaare mit Jaccarddistanz kleiner als ein
Schwellenwert s (z.B. s = 0.2)
âˆ’ Idee: Verwende Hash-Funktion, die Ã¤hnliche Dokumente in gleiche
Buckets sortiert und unÃ¤hnliche Dokumente in unterschiedliche
Buckets
âˆ’ Effektive Methode (zum Beispiel):
r Zeilen pro
âˆ’ Teilung der Signaturmatrix in
b BÃ¤nder mit jeweils r Reihen
âˆ’ Eine Hash-Funktion fÃ¼r jedes
Band, welche einen Vektor aus
r Zahlen auf eine groÃŸe Anzahl an
Buckets verteilt
âˆ’ Kandidaten sind zwei Signaturen,
die mind. einmal in den gleichen
Bucket sortiert wurden
âˆ’ Einstellung von b und r zur Optimierung

Band
Eine
Signatur

Signatur-Matrix
6-34

HASHING DER BÃ„NDER
Buckets

Spalten 2 und 6 sind in diesem
Band wahrscheinlich gleich

Spalten 6 und 7 sind hier
garantiert unterschiedlich

Annahme: Es gibt genÃ¼gend Buckets,
so dass zwei Spalten mit hoher
Wahrscheinlichkeit nur dann in den
gleichen Bucket sortiert werden, wenn
sie in einem Band identisch sind

6-35

HASH-FUNKTION: BEISPIEL
âˆ’ Man benÃ¶tigt eine Hash-Funktion pro Band
âˆ’ Wie findet man genÃ¼gend Hash-Funktionen?
âˆ’ MurmurHash mit verschiedenen Seeds
âˆ’ Original in C++: https://github.com/aappleby/smhasher/wiki
âˆ’ Java Implementierung: z.B. in Guava (https://github.com/google/guava)
âˆ’ Python: mmh3 (https://pypi.org/project/mmh3)

âˆ’ Beliebige Hash-Funktionen und XOR mit Zufallszahl
âˆ’ Liste mit Hash-Funktionen:
https://en.wikipedia.org/wiki/List_of_hash_functions
âˆ’ Auch unsichere Hash-Funktionen wie MD5 kÃ¶nnen verwendet werden
âˆ’ Java Implementierung: z.B. in Guava
(https://github.com/google/guava/wiki/HashingExplained)
âˆ’ XOR in Java:
âˆ’ int a = 60; /* 60 = 0011 1100 */
âˆ’ int b = 13; /* 13 = 0000 1101 */
âˆ’ int c = a ^ b; /* 49 = 0011 0001 */
6-36

BEISPIEL
â€¢
â€¢

Signaturmatrix mit 100 Zeilen
Setze b = 20 und r = 5
Fall 1: 2 Dokumente mit d(C, D) = 0.2
âˆ’ Wahrscheinlichkeit, dass C und D in
einem bestimmten Band identisch:
1 âˆ’ 0.2 5 = 0.328
âˆ’ Wahrscheinlichkeit, dass C und D in
keinem Band identisch:
1 âˆ’ 0.328 20 = 0.00035
âˆ’ d.h. einer von 3000 Paaren mit 80%Ã„hnlichkeit werden nicht entdeckt
(False Negative)

Fall 2: 2 Dokumente mit d(C, D) = 0.7
âˆ’ Wahrscheinlichkeit, dass C und D in
einem bestimmten Band identisch:
0.3 5 = 0.00243
âˆ’ Wahrscheinlichkeit, dass C und D in
mind. einem Band identisch:
1 âˆ’ 1 âˆ’ 0.00243 20 = 0.0474
âˆ’ d.h. 4.74% der Paaren mit 30%Ã„hnlichkeit werden zu Kandidaten
(False Positives)

6-37

LSH: ANALYSE
âˆ’ Angenommen ð‘¡ = 1 âˆ’ ð‘‘(ð¶, ð·) , ð‘ BÃ¤nder mit jeweils ð‘Ÿ Zeilen
âˆ’ Wahrscheinlichkeit, dass C und D in mind. einem Band identisch:
1 âˆ’ 1 âˆ’ ð‘¡ð‘Ÿ ð‘

âˆ’ WÃ¤hle (2 aus 3):
âˆ’ Die Anzahl der Min-Hashes (Zeilen der Signatur-Matrix)
âˆ’ Die Anzahl der BÃ¤nder ð‘
âˆ’ Die Anzahl der Reihen pro Band ð‘Ÿ

âˆ’

um die Raten der False Positives und False Negatives
anzugleichen
âˆ’ Beispiel: Bei b = 10 und r = 10 anstatt b = 20 und r = 5 wÃ¼rde es
weniger False Positives aber mehr False Negatives geben

6-38

LSH: ANALYSE

Idealfall

Eins falls
t > 1-s
Null falls
t < 1-s

1-s

Wahrscheinlichkeit
im gleichen Bucket
zu landen

Ã„hnlichkeit ð‘¡ = 1 âˆ’ ð‘‘(ð¶, ð·)
zweier Dokumente
6-39

LSH: ANALYSE

1 Zeile und 1 Band: 1 âˆ’ 1 âˆ’ ð‘¡ ð‘Ÿ ð‘ = ð‘¡

False
Negatives

Wahrscheinlichkeit
im gleichen Bucket
zu landen
False
Positives

1-s

Ã„hnlichkeit ð‘¡ = 1 âˆ’ ð‘‘(ð¶, ð·)
zweier Dokumente
6-40

LSH: ANALYSE

r Zeilen und b BÃ¤nder

Wahrscheinlichkeit
im gleichen Bucket
zu landen

1 âˆ’ 1 âˆ’ ð‘¡ð‘Ÿ ð‘
1
â‰ˆ
ð‘

1
ð‘Ÿ

Ã„hnlichkeit ð‘¡ = 1 âˆ’ ð‘‘(ð¶, ð·)
zweier Dokumente
6-41

ZUSAMMENFASSUNG

âˆ’ Einleitung
âˆ’ One-Hot-Kodierung
âˆ’ Min-Hash Signaturen
âˆ’ Locality Sensitive Hashing

6-42

